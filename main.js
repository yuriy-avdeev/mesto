(()=>{"use strict";class e{constructor(e,t,r,s){var i,o,{handleCardClick:n,handleBasketClick:a,counterLikes:c}=s;o=e=>{e.classList.toggle("".concat(this._placeLikeSelector,"_click"));var t=!!this._element.querySelector(".".concat(this._placeLikeSelector,"_click"));this._counterLikes(t)},(i="_likeCard")in this?Object.defineProperty(this,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):this[i]=o,this._userID=e._id,this._data=t,this._cardTemplate=r,this._newCardSelector=".photo-place",this._placeLikeSelector="photo-place__like",this._newCardElement=this._cardTemplate.querySelector(this._newCardSelector),this._handleCardClick=n,this._handleBasketClick=a,this._counterLikes=c,this._element=this._getTemplate(),this._placeWithImage=this._element.querySelector(".photo-place__image"),this._placeWithCaption=this._element.querySelector(".photo-place__caption"),this._placeLikeSymbol=this._element.querySelector(".photo-place__like"),this._counterLikeElement=this._element.querySelector(".photo-place__like-number"),this._placeBasketSymbol=this._element.querySelector(".photo-place__basket")}_getTemplate(){if(this._data.owner._id!==this._userID){var e=this._newCardElement.cloneNode(!0);return e.querySelector(".photo-place__basket").remove(),e}return this._newCardElement.cloneNode(!0)}generateCard(){return this._setEventListeners(),this._placeWithImage.src=this._data.link,this._placeWithCaption.textContent=this._data.name,this._counterLikeElement.textContent=this._data.likes.length,this._placeWithImage.alt="загруженное изображение",this._data.likes.forEach((e=>{e._id==this._userID&&this._placeLikeSymbol.classList.add("".concat(this._placeLikeSelector,"_click"))})),this._element}_setEventListeners(){this._placeWithImage.addEventListener("click",(()=>{this._handleCardClick()})),this._placeLikeSymbol.addEventListener("click",(()=>{this._likeCard(this._placeLikeSymbol)})),this._placeBasketSymbol&&this._placeBasketSymbol.addEventListener("click",(()=>{this._handleBasketClick()}))}updateLikes(e){this._counterLikeElement.textContent=e}getCardId(){return this._data._id}removeCard(){this._element.remove()}}class t{constructor(e,t){this._formElement=t,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonSelector=e.inactiveButtonSelector,this._inputErrorSelector=e.inputErrorSelector,this._errorMessageSelector=e.errorMessageSelector,this._buttonElement=this._formElement.querySelector(this._submitButtonSelector),this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector))}setInputListener(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._isValid(e),this._toggleButtonView()}))}))}resetValidation(){this._toggleButtonView(),this._inputList.forEach((e=>{this._hideInputError(e)}))}_isValid(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_showInputError(e,t){this._errorElement=this._formElement.querySelector(".".concat(e.id,"-error")),this._errorElement.textContent=t,e.classList.add(this._inputErrorSelector),this._errorElement.classList.add(this._errorMessageSelector)}_hideInputError(e){this._errorElement=this._formElement.querySelector(".".concat(e.id,"-error")),e.classList.remove(this._inputErrorSelector),this._errorElement.classList.remove(this._errorMessageSelector),this._errorElement.textContent=""}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_toggleButtonView(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._inactiveButtonSelector),this._buttonElement.setAttribute("disabled",!0)):(this._buttonElement.classList.remove(this._inactiveButtonSelector),this._buttonElement.removeAttribute("disabled"))}}class r{constructor(e){var t,r;r=e=>{"Escape"===e.key&&this.close()},(t="_handleEscClose")in this?Object.defineProperty(this,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[t]=r,this._popup=document.querySelector(e),this._popupActiveSelector="popup_active",this._buttonClosePopup=this._popup.querySelector(".popup__close")}open(){this._popup.classList.add(this._popupActiveSelector),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove(this._popupActiveSelector),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._buttonClosePopup.addEventListener("click",(()=>{this.close()})),this._popup.addEventListener("click",(e=>{e.target===e.currentTarget&&this.close()}))}}class s extends r{constructor(e){var{popupSelector:t,handleFormSubmit:r}=e;super(t),this._popupSelector=t,this._handleFormSubmit=r,this._popupForm=this._popup.querySelector(".popup__form"),this._inputsList=this._popup.querySelectorAll(".popup__input"),this._buttonSubmit=this._popup.querySelector(".popup__submit"),this._initialText=this._buttonSubmit.textContent}_getInputValues(){return this._formValues={},this._inputsList.forEach((e=>this._formValues[e.name]=e.value)),this._formValues}renderLoading(e){this._buttonSubmit.textContent=e?"Сохранение...":this._initialText}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}close(){super.close(),this._popupForm.reset()}}function i(e,t,r,s,i,o,n){try{var a=e[o](n),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(s,i)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(s,o){var n=e.apply(t,r);function a(e){i(n,s,o,a,c,"next",e)}function c(e){i(n,s,o,a,c,"throw",e)}a(void 0)}))}}var n=document.querySelector(".profile__editor-popup"),a=document.querySelector(".popup__form-user"),c=a.querySelector(".popup__input_type_name"),l=a.querySelector(".popup__input_type_activity"),h=document.querySelector(".profile__add-place"),p=document.querySelector(".popup__form-add"),u=document.querySelector("#photo-place").content,_=document.querySelector(".popup__form-avatar-change"),d=document.querySelector(".profile__avatar-edit"),m=(document.querySelector(".popup-delete").querySelector(".popup__submit-confirm"),{inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonSelector:"popup__submit_inactive",inputErrorSelector:"popup__input_state_error",errorMessageSelector:"popup__input-error_active"}),v=new class extends r{constructor(e){super(e),this._bigFoto=this._popup.querySelector(".popup-image__big-foto"),this._bigCaption=this._popup.querySelector(".popup-image__caption")}open(e,t){super.open(),this._bigFoto.src=e,this._bigCaption.textContent=t,this._bigFoto.alt="увеличенное выбранное изображение"}}(".popup-image");v.setEventListeners();var S=new class{constructor(e){var{nameUserSelector:t,activityUserSelector:r,avatarUserSelector:s}=e;this._name=document.querySelector(t),this._activity=document.querySelector(r),this._avatar=document.querySelector(s)}getUserInfo(){var e={};return e.name=this._name.textContent,e.activity=this._activity.textContent,e.avatar=this._userData.avatar,e}setUserInfo(e){this._userData=e,this._name.textContent=this._userData.name,this._activity.textContent=this._userData.about,this._avatar.src=this._userData.avatar}}({nameUserSelector:".profile__name",activityUserSelector:".profile__activity",avatarUserSelector:".profile__photo"}),k=new t(m,p);k.setInputListener();var y=new t(m,a);y.setInputListener();var E=new t(m,_);E.setInputListener();var L=new class extends r{constructor(e){super(e),this._popupForm=this._popup.querySelector(".popup__form")}open(e){super.open(),this._handleConfirm=e}close(){super.close(),this._popupForm.removeEventListener("submit",this._handleConfirm)}}(".popup-delete");L.setEventListeners();var g=new class{constructor(e,t){var{renderer:r}=e;this._renderer=r,this._container=document.querySelector(t)}renderItems(e){e.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({renderer:e=>{var t=C(e);g.addItem(t)}},".places"),f=new class{constructor(e){var{url:t,headers:r}=e;this._url=t,this._headers=r}_checkResponse(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status," - ").concat(e.statusText))}getUser(){var e=this;return o((function*(){var t=yield fetch("".concat(e._url,"/users/me"),{headers:e._headers});return e._checkResponse(t)}))()}likeCard(e){var t=this;return o((function*(){var r=yield fetch("".concat(t._url,"/cards/likes/").concat(e),{method:"PUT",headers:t._headers});return t._checkResponse(r)}))()}getCards(){return fetch("".concat(this._url,"/cards"),{headers:this._headers}).then(this._checkResponse)}deleteCard(e){return fetch("".concat(this._url,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then(this._checkResponse)}likeCardCancel(e){return fetch("".concat(this._url,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then(this._checkResponse)}saveUserInfo(e){var{name:t,activity:r}=e;return fetch("".concat(this._url,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})}).then(this._checkResponse)}saveNewCard(e){var{name:t,url:r}=e;return fetch("".concat(this._url,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})}).then(this._checkResponse)}newAvatar(e){return fetch("".concat(this._url,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}}({url:"https://mesto.nomoreparties.co/v1/cohort-24",headers:{authorization:"0077ba4a-e2dd-4b84-9d2b-fc9f32407d03","Content-Type":"application/json"}}),b=null;Promise.all([f.getUser(),f.getCards()]).then((e=>{var[t,r]=e;S.setUserInfo(t),b=t,r=r.slice(0,6),g.renderItems(r)})).catch((e=>console.log(e)));var C=t=>{var r=new e(b,t,u,{handleCardClick(){v.open(t.link,t.name)},handleBasketClick(){var e=e=>{e.preventDefault(),f.deleteCard(r.getCardId()).then((()=>{r.removeCard(),L.close()})).catch((e=>console.log(e)))};L.open(e),document.querySelector(".popup_active").querySelector(".popup__form").addEventListener("submit",e)},counterLikes(e){e?f.likeCard(r.getCardId()).then((e=>{r.updateLikes(e.likes.length)})).catch((e=>console.log(e))):f.likeCardCancel(r.getCardId()).then((e=>{r.updateLikes(e.likes.length)})).catch((e=>console.log(e)))}});return r.generateCard()},I=new s({popupSelector:".popup-addfoto",handleFormSubmit:e=>{I.renderLoading(!0),f.saveNewCard({name:e.name,url:e.link}).then((e=>{g.renderItems([e]),I.renderLoading(!1),I.close()})).catch((e=>console.log(e)))}});I.setEventListeners(),h.addEventListener("click",(()=>{k.resetValidation(),I.open()}));var q=new s({popupSelector:".profile-popup",handleFormSubmit:e=>{q.renderLoading(!0),f.saveUserInfo({name:e.name,activity:e.activity}).then((e=>{S.setUserInfo(e),q.renderLoading(!1),q.close()})).catch((e=>console.log(e)))}});q.setEventListeners(),n.addEventListener("click",(()=>{c.value=S.getUserInfo().name,l.value=S.getUserInfo().activity,y.resetValidation(),q.open()}));var w=new s({popupSelector:".popup-avatar",handleFormSubmit:e=>{w.renderLoading(!0),f.newAvatar(e.link).then((e=>{S.setUserInfo(e),w.renderLoading(!1),w.close()})).catch((e=>console.log(e)))}});w.setEventListeners(),d.addEventListener("click",(()=>{E.resetValidation(),w.open()}))})();